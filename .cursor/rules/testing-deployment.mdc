---
description: –ü—Ä–∞–≤–∏–ª–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –¥–ª—è MEXC Telegram Bot
globs: ["**/*.py", "Dockerfile", "docker-compose.yml", "**/*.sh", "**/*.cron"]
---

# –ü—Ä–∞–≤–∏–ª–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

## Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### Dockerfile
```dockerfile
# –ò—Å–ø–æ–ª—å–∑—É–µ–º Python 3.11 slim –æ–±—Ä–∞–∑
FROM python:3.11-slim

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
ENV PYTHONUNBUFFERED=1
ENV PYTHONDONTWRITEBYTECODE=1

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–±–æ—á—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
WORKDIR /app

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
RUN apt-get update && apt-get install -y \
    gcc \
    && rm -rf /var/lib/apt/lists/*

# –ö–æ–ø–∏—Ä—É–µ–º –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# –ö–æ–ø–∏—Ä—É–µ–º –∫–æ–¥ –ø—Ä–æ–µ–∫—Ç–∞
COPY . .

# –°–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±–µ–∑ –ø—Ä–∞–≤ root
RUN useradd --create-home --shell /bin/bash app \
    && chown -R app:app /app
USER app

# –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
CMD ["python", "main.py"]
```

### Docker Compose
```yaml
version: '3.8'

services:
  mexc-bot:
    build: .
    env_file:
      - .env
    volumes:
      - ./logs:/app/logs
    restart: unless-stopped
    depends_on:
      - redis  # –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

  fair-price-monitor:
    build: .
    env_file:
      - .env
    command: python fair_price_monitor.py
    volumes:
      - ./logs:/app/logs
    restart: unless-stopped

  redis:
    image: redis:7-alpine
    volumes:
      - redis_data:/data
    restart: unless-stopped

volumes:
  redis_data:
```

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
```python
# core/logging_config.py
import logging
import logging.handlers
from pathlib import Path

def setup_logging(log_level: str = "INFO", log_file: str = "logs/bot.log") -> logging.Logger:
    """–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è."""

    # –°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –ª–æ–≥–æ–≤
    log_path = Path(log_file)
    log_path.parent.mkdir(parents=True, exist_ok=True)

    # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–æ—Ä–º–∞—Ç—Ç–µ—Ä–∞
    formatter = logging.Formatter(
        '%(asctime)s - %(name)s - %(levelname)s - %(message)s',
        datefmt='%Y-%m-%d %H:%M:%S'
    )

    # –ö–æ–Ω—Å–æ–ª—å–Ω—ã–π handler
    console_handler = logging.StreamHandler()
    console_handler.setFormatter(formatter)

    # –§–∞–π–ª–æ–≤—ã–π handler —Å —Ä–æ—Ç–∞—Ü–∏–µ–π
    file_handler = logging.handlers.RotatingFileHandler(
        log_file,
        maxBytes=10*1024*1024,  # 10MB
        backupCount=5
    )
    file_handler.setFormatter(formatter)

    # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ root logger
    logger = logging.getLogger()
    logger.setLevel(getattr(logging, log_level.upper()))

    # –î–æ–±–∞–≤–ª—è–µ–º handlers —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
    if not logger.handlers:
        logger.addHandler(console_handler)
        logger.addHandler(file_handler)

    return logger
```

### –£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
```python
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–¥–µ
logger.debug(f"Starting API requests for symbol: {symbol}")
logger.info("Fair price alert services started")
logger.warning(f"API returned error for {symbol}: {error}")
logger.error(f"Critical error in monitoring loop: {e}", exc_info=True)
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –º–µ—Ç—Ä–∏–∫–∏

### Health check —ç–Ω–¥–ø–æ–∏–Ω—Ç
```python
# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –±–æ—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–¥–æ—Ä–æ–≤—å—è
@dp.message(Command("health"))
async def health_check(message):
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–∏—Å–æ–≤."""
    health_status = {
        "bot": "‚úÖ",
        "mexc_api": "‚ùì",
        "gate_api": "‚ùì",
        "websocket": "‚ùì",
        "database": "‚ùì"
    }

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ MEXC API
    try:
        ok, _, _ = await container.mexc_client.fetch_futures_ticker("BTC_USDT")
        health_status["mexc_api"] = "‚úÖ" if ok else "‚ùå"
    except:
        health_status["mexc_api"] = "‚ùå"

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ Gate API
    try:
        ok, _, _ = await container.gate_client.fetch_futures_tickers()
        health_status["gate_api"] = "‚úÖ" if ok else "‚ùå"
    except:
        health_status["gate_api"] = "‚ùå"

    # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞
    response_lines = ["üè• *Health Check*", ""]
    for service, status in health_status.items():
        response_lines.append(f"‚Ä¢ {service}: {status}")

    response = container.markdown_service.convert_to_markdown_v2("\n".join(response_lines))
    await message.reply(response, parse_mode=ParseMode.MARKDOWN_V2)
```

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### .env —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
```bash
# Bot configuration
BOT_TOKEN=your_telegram_bot_token_here

# MEXC API (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è Buy Limit)
MEXC_API_KEY=your_mexc_api_key
MEXC_API_SECRET=your_mexc_api_secret

# Gate.io API (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
GATE_API_KEY=your_gate_api_key
GATE_API_SECRET=your_gate_api_secret

# Proxy (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
HTTP_PROXY=http://username:password@host:port

# Telegram alerts
ALERT_CHAT_ID=-1003321617744

# Logging
LOG_LEVEL=INFO
```

### env.example
```bash
# Telegram Bot Token (required)
BOT_TOKEN=

# MEXC API Credentials (optional, for Buy Limit feature)
MEXC_API_KEY=
MEXC_API_SECRET=

# Gate.io API Credentials (optional)
GATE_API_KEY=
GATE_API_SECRET=

# Proxy Configuration (optional)
HTTP_PROXY=

# Alert Configuration
ALERT_CHAT_ID=-1003321617744

# Logging Level
LOG_LEVEL=INFO
```

## Cron jobs –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### fair-price-monitor.cron
```bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —á–µ—Ä–µ–∑ cron
#!/bin/bash

# –ü–µ—Ä–µ—Ö–æ–¥ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd /path/to/mexc-bot-tg

# –ê–∫—Ç–∏–≤–∞—Ü–∏—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
# source venv/bin/activate

# –ó–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
python main.py &
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ cron
```bash
# –î–æ–±–∞–≤–∏—Ç—å –≤ crontab –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
crontab -e

# –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É:
*/5 * * * * /path/to/project/fair-price-monitor.cron
```

## –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### Production checklist
- [ ] –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å `env.example` –≤ `.env`
- [ ] –ó–∞–ø–æ–ª–Ω–∏—Ç—å –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å API –∫–ª—é—á–µ–π
- [ ] –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Docker –∏ Docker Compose
- [ ] –°–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –ª–æ–≥–æ–≤: `mkdir -p logs`
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å: `docker-compose up -d`
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏: `docker-compose logs -f`
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –∫–æ–º–∞–Ω–¥ –≤ Telegram

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ production
```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs -f mexc-bot

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker-compose ps

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose restart mexc-bot

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫
docker-compose up -d --build
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### API –∫–ª—é—á–∏
- –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—å `.env` —Ñ–∞–π–ª
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–µ–∫—Ä–µ—Ç–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ CI/CD
- –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ API –∫–ª—é—á–∞–º
- –†–µ–≥—É–ª—è—Ä–Ω–æ —Ä–æ—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á–∏

### Docker –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
```dockerfile
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ-root –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
RUN useradd --create-home --shell /bin/bash app \
    && chown -R app:app /app
USER app

# –ù–µ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –Ω–µ–Ω—É–∂–Ω—ã–µ —Ñ–∞–π–ª—ã
COPY --chown=app:app . .

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å .dockerignore
# .git
# .env
# logs/
# *.pyc
# __pycache__/
```

## –û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π

### Blue-green deployment
```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –æ–±—Ä–∞–∑–∞
docker build -t mexc-bot:new .

# –ó–∞–ø—É—Å–∫ –Ω–æ–≤–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
docker run -d --name mexc-bot-new -p 8081:8080 mexc-bot:new

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
curl http://localhost:8081/health

# –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç—Ä–∞—Ñ–∏–∫–∞ (nginx –∏–ª–∏ –∞–Ω–∞–ª–æ–≥)
# docker stop mexc-bot-old
# docker rename mexc-bot mexc-bot-old
# docker rename mexc-bot-new mexc-bot
```